version: "4.8"

services:
  openssl:
    image: sysbender/my-splunk-universalforwarder
    ports:
      - "9997:9997"

    # volumes:
    #   - ./certs:/etc/ssl/certs
    # entrypoint: ["/bin/sh", "-c"]
    # command: >
    #   "if [ ! -f /etc/ssl/certs/ca-key.pem ]; then
    #     mkdir -p /etc/ssl/certs &&
    #     openssl genrsa -out /etc/ssl/certs/server-key.pem 2048 &&
    #     openssl req -new -x509 -key /etc/ssl/certs/server-key.pem -out /etc/ssl/certs/server-cert.pem -days 365 -subj '/CN=syslog-ng' -addext 'subjectAltName=DNS:syslog-ng,IP:192.168.0.122,IP:127.0.0.1' &&
    #     openssl genrsa -out /etc/ssl/certs/ca-key.pem 2048 &&
    #     openssl req -new -x509 -key /etc/ssl/certs/ca-key.pem -out /etc/ssl/certs/ca-cert.pem -days 365 -subj '/CN=myca' &&
    #     openssl genrsa -out /etc/ssl/certs/client-key.pem 2048 &&
    #     openssl req -new -key /etc/ssl/certs/client-key.pem -out /etc/ssl/certs/client-cert.csr -days 365 -subj '/CN=tls-log-generator' -addext 'subjectAltName=DNS:tls-log-generator,IP:192.168.0.122' &&
    #     openssl x509 -req -in /etc/ssl/certs/client-cert.csr -CA /etc/ssl/certs/ca-cert.pem -CAkey /etc/ssl/certs/ca-key.pem -set_serial 01 -days 365 -out /etc/ssl/certs/client-cert.pem;
    #   else
    #     echo \"Certificates already exist. Skipping generation.\";
    #   fi
    #   "
